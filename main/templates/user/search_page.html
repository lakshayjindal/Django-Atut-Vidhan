{% extends "base.html" %}
{% block content %}
<form id="search-form" class="search-form">
  <input type="text" name="q" placeholder="Name">
  <input type="text" name="city" placeholder="City">
  <input type="text" name="profession" placeholder="Profession">
  <select name="gender">
    <option value="">Gender</option>
    <option value="M">Male</option>
    <option value="F">Female</option>
    <option value="O">Other</option>
  </select>
  <select name="marital_status">
    <option value="">Marital Status</option>
    <option value="single">Single</option>
    <option value="divorced">Divorced</option>
  </select>
  <input type="number" name="age_min" placeholder="Min Age">
  <input type="number" name="age_max" placeholder="Max Age">
</form>

<div id="results-area">
  {% include "user/partials/_search_results.html" with profiles=profiles %}
</div>
{% endblock %}

{% block extra_js %}
<script>
  const form = document.getElementById('search-form');
  const resultsArea = document.getElementById('results-area');

  const fetchResults = () => {
    const params = new URLSearchParams(new FormData(form)).toString();
    fetch(`/ajax/search/?${params}`)
      .then(response => response.json())
      .then(data => {
        resultsArea.innerHTML = data.html;
      });
  }

  form.addEventListener('input', () => {
    clearTimeout(window._delay);
    window._delay = setTimeout(fetchResults, 300);  // debounce to avoid hammering server
  });
</script>
{% endblock %}