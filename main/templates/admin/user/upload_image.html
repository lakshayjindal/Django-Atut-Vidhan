{% extends "admin/base_site.html" %}
{% block content %}


<h2 class="upload-title">Upload Images</h2>
<form method="post" enctype="multipart/form-data" class="upload-form">
  {% csrf_token %}
  <input type="file" name="images" multiple class="file-input">
  <button type="submit" class="btn-primary">Upload</button>
</form>

{% if pictures %}
  <hr class="divider">
  <h2 class="map-title">Map Images to Users</h2>

  <form method="post" class="mapping-form">
    {% csrf_token %}
    <table class="mapping-table">
      <thead>
        <tr>
          <th>Preview</th>
          <th>Assign to User</th>
          <th>Profile Picture</th>
        </tr>
      </thead>
      <tbody>
        {% for picture in pictures %}
          <tr>
            <!-- Image Preview -->
            <td>
              <img src="{{ picture.picture_url }}" alt="preview" class="preview-img">
            </td>

            <!-- User Dropdown -->
            <td>
              <select name="user_{{ picture.id }}" class="user-select">
                <option value="">-- Select User --</option>
                {% for user in users %}
                  <option value="{{ user.id }}">{{ user.username }}</option>
                {% endfor %}
              </select>
            </td>

            <!-- Profile Picture Radio -->
            <td>
              <label class="radio-label">
                <input type="radio" name="profile_picture_{{ picture.id }}" class="profile-radio" value="{{ picture.id }}">
                Set as Profile
              </label>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="actions">
      <button type="submit" class="btn-success">Save Mappings</button>
    </div>
  </form>
{% endif %}

<style>
/* Headings */
/* Titles */
.upload-title, .map-title {
  color: var(--primary);
  font-family: var(--font-family-secondary);
  margin-bottom: var(--spacing);
  text-align: center;
    font-size: 25px;
}

/* Forms */
.upload-form, .mapping-form {
  background: var(--darkened-bg);
  padding: var(--spacing);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  margin-bottom: var(--spacing);
  color: var(--body-fg);
}

/* Divider */
.divider {
  border: none;
  border-top: 2px dashed var(--secondary);
  margin: calc(var(--spacing) * 2) 0;
}

/* File Input */
.file-input {
  padding: 8px;
  border: 2px solid var(--secondary);
  border-radius: var(--border-radius);
  background: var(--body-bg);
  margin-right: 10px;
  color: var(--body-fg);
}

/* Buttons */
.btn-primary {
  background: var(--primary);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: 0.3s;
  font-family: var(--font-family-primary);
}
.btn-primary:hover {
  background: var(--error);
}

.btn-success {
  background: var(--success);
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: var(--border-radius);
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
  font-family: var(--font-family-primary);
}
.btn-success:hover {
  background: #3b8b58;
}

/* Table */
.mapping-table {
  width: 100%;
  border-collapse: collapse;
  background: var(--darkened-bg);
  color: var(--body-fg);
}
.mapping-table th {
  background: var(--secondary);
  color: var(--header-bg);
  padding: 12px;
}
.mapping-table td {
  border: 1px solid var(--border-color);
  padding: 12px;
  text-align: center;
}

/* Image Preview */
.preview-img {
  max-height: 120px;
  max-width: 120px;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  transition: transform 0.2s;
}
.preview-img:hover {
  transform: scale(1.05);
}

/* Dropdown */
.user-select {
  padding: 6px 10px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  background: var(--body-bg);
  color: var(--body-fg);
  font-family: var(--font-family-primary);
}

/* Radio */
.radio-label {
  font-size: var(--font-size-sm);
  color: var(--body-quiet-color);
  cursor: pointer;
}

/* Actions */
.actions {
  margin-top: var(--spacing);
  text-align: right;
}

</style>

<script>
document.querySelectorAll(".user-select").forEach(select => {
  select.addEventListener("change", function () {
    const pictureId = this.name.split("_")[1];
    const selectedUserId = this.value;

    const radio = document.querySelector(`input[name="profile_picture_${pictureId}"]`);
    if (selectedUserId) {
      radio.name = `profile_picture_user_${selectedUserId}`;
    } else {
      radio.name = `profile_picture_${pictureId}`;
    }
  });
});
</script>

{% endblock %}